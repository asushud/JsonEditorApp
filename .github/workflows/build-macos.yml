name: Build JsonEditor Native macOS App

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-macos-native:
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up GraalVM JDK 21
        uses: graalvm/setup-graalvm@v1
        with:
          java-version: 21
          distribution: graalvm
          components: native-image

      - name: Verify Java and GraalVM
        run: |
          java -version
          gu --version

      # ğŸ§© Compile Java sources
      - name: Compile Java
        run: |
          mkdir -p build
          javac -cp "jackson-core.jar:jackson-databind.jar:jackson-annotations.jar" -d build *.java

      # ğŸ“¦ Create a jar
      - name: Create jar
        run: |
          jar cfe JsonEditor.jar JsonEditor -C build .

      # ğŸš€ Build native image
      - name: Build native executable using GraalVM
        run: |
          native-image \
            --no-fallback \
            --initialize-at-build-time \
            -jar JsonEditor.jar \
            JsonEditor

      # ğŸ“ Prepare output
      - name: Prepare artifact
        run: |
          mkdir -p output
          mv JsonEditor output/

      # â¬†ï¸ Upload artifact
      - name: Upload macOS binary
        uses: actions/upload-artifact@v4
        with:
          name: JsonEditor-macOS-Native
          path: output/
